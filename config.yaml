# Stemset Configuration
# Multiple profiles allow you to process different recording sources

# Authentication (optional - comment out to disable auth)
# Environment variables will be substituted: ${VAR_NAME}
auth:
  allowed_emails:
    - sastraxi@gmail.com
    - EvanMitchell101@gmail.com
    - beccacuddy@gmail.com
    - andreiidobrinski@gmail.com
    - KyleDanaMarsh@gmail.com
  google_client_id: ${GOOGLE_CLIENT_ID}
  google_client_secret: ${GOOGLE_CLIENT_SECRET}
  jwt_secret: ${JWT_SECRET}
  redirect_uri: ${OAUTH_REDIRECT_URI}

# Cloudflare R2 Storage (required for production API and remote processing)
# For local dev: Keep this uncommented - CLI will sync with R2 automatically (STEMSET_SYNC=true by default)
# For remote processing: Required for GPU worker to access files
# For API: Required for serving files to frontend in production
# Environment variables will be substituted: ${VAR_NAME}
r2:
  account_id: ${R2_ACCOUNT_ID}
  access_key_id: ${R2_ACCESS_KEY_ID}
  secret_access_key: ${R2_SECRET_ACCESS_KEY}
  bucket_name: ${R2_BUCKET_NAME}
  public_url: ${R2_PUBLIC_URL}  # Optional: if bucket has public access

# GPU Worker URL (required for remote GPU processing)
# Modal endpoint format: https://<workspace>--stemset-gpu-process.modal.run
# Set GPU_WORKER_URL environment variable or use --local flag for local processing
gpu_worker_url: ${GPU_WORKER_URL}

strategies:
#################################

  # Faster, lower-quality (squishier sounding)
  htdemucs_ft:
    _: "htdemucs_ft"
    vocals: vocals
    bass: bass
    drums: drums
    other: other

  # Pretty decent separation.
  hdemucs_mmi:
    _: "hdemucs_mmi"
    vocals: vocals
    bass: bass
    drums: drums
    other: other

  successive:
    _: "vocals_mel_band_roformer.ckpt"
    vocals: vocals
    other: 
      _: "kuielab_b_drums.onnx"
      drums: drums
      no drums:
        _: "kuielab_a_bass.onnx"
        bass: bass
        no bass: other

profiles:
#################################
  - name: "h4n"
    source_folder: "/Volumes/H4N_SD/STEREO"
    strategy: "hdemucs_mmi"
    output:
      format: "opus"
      bitrate: 192

  - name: "one"
    source_folder: "./input/one"
    strategy: "htdemucs_ft"
    remote: true
    output:
      format: "opus"
      bitrate: 192

  - name: "experimental"
    source_folder: "./input/experimental"
    strategy: "successive"
    remote: true
    output:
      format: "opus"
      bitrate: 192
